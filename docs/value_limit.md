# テーブル定義で使用可能なデータ型と値の範囲

2022-10-20 kurosawa

## この文書について

SQL実行エンジンのテーブル定義において使用可能なデータ型の値の範囲について記述する

## データ型と範囲

SQL実行エンジンがサポートするデータ型とテーブルに保存される値のとりえる範囲について下表に示す

| SQLデータ型 | 使用可能な値 | 備考 |
|:--|:--|:--|
| `BOOLEAN` | `FALSE`/`TRUE` | | 
 `TINYINT` | 範囲 `[-128, 127]` の整数 | |
| `SMALLINT` | 範囲 `[-32768, 32767]` の整数 | |
| `INT` | 範囲 `[-2147483648, 2147483647]` の整数  | |
| `BIGINT` | 範囲 `[-9223372036854775808, 9223372036854775807]` の整数  | |
| `REAL` | 範囲 `[-3.40282e+38, 3.40282e+38]`の浮動小数点数(IEEE 754規定による) <br> `INF` , `-INF` , `NaN` , `+0` , `-0` を含む | 正の最小値: `1.17549e-38` <br> 負の最大値: `-1.17549e-38` |
| `DOUBLE` | 範囲 `[-1.79769e+308, 1.79769e+308]` の浮動小数点数(IEEE 754規定による) <br> `INF` , `-INF` , `NaN` , `+0` , `-0` を含む<br>  | 正の最小値: `2.22507e-308` <br> 負の最大値: `-2.22507e-308` |
| `DECIMAL(p,s)` | 範囲 `[-(10^p-1)*10^(-s), (10^p-1)*10^(-s)]` の十進数で精度(有効桁数) `p`, スケール(小数部桁数) `s`のもの | 指定可能な `p` の範囲は `[1, 38]`, `s` の範囲は `[0, p]`. `p`には任意精度`*`を指定する事も可能 (*3) |
| `CHAR(n)` | UTF-8で `n` オクテットを使用して表現可能な文字列 | 値の長さが `n` オクテットに満たない場合はパディングされる. 指定可能な `n` の範囲は `[1, 2097132]`. 主キーやインデックスのキー列に使用する際は `n` の上限は `30716`. |
| `VARCHAR(n)` | UTF-8で `[0, n]` オクテットを使用して表現可能な文字列 |  指定可能な `n` の範囲は `[1, 2097132]`. 任意長の指定も可能 (*3). 主キーやインデックスのキー列に使用する際は `n` の上限は `30716`. |
| `BINARY(n)` | `n` オクテットのバイナリ列  | 値が `n` オクテットに満たない場合はパディングされる. 指定可能な `n` の範囲は `[1, 2097132]`. 主キーやインデックスのキー列に使用する際は `n` の上限は `30716`. |
| `BINARY VARYING(n)` <br> `VARBINARY(n)` | 長さが `[0, n]` オクテットのバイナリ列 | 指定可能な `n` の範囲は `[1, 2097132]`. 任意長の指定も可能(*3). 主キーやインデックスのキー列には使用不可. |
| `DATE` | 範囲 `[-999999999-01-01, 999999999-12-31]` の日付 | (*2) | 
| `TIME` | 範囲 `[00:00:00.000000000, 23:59:59.999999999]` の時刻 (精度: ナノ秒) | (*2) | 
| `TIME WITH TIME ZONE` | 範囲 `[00:00:00.000000000, 23:59:59.999999999]`の時刻部分 (精度: ナノ秒) と <br> 範囲 `[-18*60, 18*60]` のオフセット部分(精度: 分)からなるタイムゾーンオフセットつき時刻 | | 
| `TIMESTAMP` | 範囲 `[-999999999-01-01T00:00:00.000000000, +999999999-12-31T23:59:59.999999999]` の日付つき時刻 (精度: ナノ秒) | (*2) | 
| `TIMESTAMP WITH TIME ZONE` | 範囲 `[-999999999-01-01T00:00:00.000000000, +999999999-12-31T23:59:59.999999999]` の日付つき時刻部分 (精度: ナノ秒) と <br> 範囲 `[-18*60, 18*60]` のオフセット部分(精度: 分)からなるタイムゾーンオフセットつき日付つき時刻 | (*2) | 
| `INTERVAL` |-| サポート予定だが詳細はTBD |
| `ARRAY` |-|サポート予定だが詳細はTBD |
| `ROW` |-| サポート予定だが詳細はTBD |

記法：範囲 `[a, b]` は端点 `a`, `b` を含む(閉区間)

(*2) 時刻系データの範囲は[java.timeパッケージ](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/package-summary.html) のクラスの最大値・最小値を参考にしている. 

(*3) パラメーター (`n` や `p`) に `*` を指定すると任意長の指定となり、設定可能な最大長が自動的に選択される

## その他

- 本文書はテーブルに保存されるデータの値について述べているが、計算過程や計算結果の出力においては一時的により広い範囲の値を取りうるので注意が必要である
  - 例えばcast式に現れるデータ型は計算過程の値を取り扱うので上記の制約と異なることがある


